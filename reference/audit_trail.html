<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Facilitate the Creation and Modification of Audit Trails — Audit Trails • oro.nifti</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Facilitate the Creation and Modification of Audit Trails — Audit Trails" />
<meta property="og:description" content="Facilitate the creation and modification of audit trails for NIfTI class
objects." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">oro.nifti</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/nifti2.html">Working with the NIfTI Data Standard in \proglang{R}</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/bjw34032/oro.nifti/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Facilitate the Creation and Modification of Audit Trails</h1>
    <small class="dont-index">Source: <a href='https://github.com/bjw34032/oro.nifti/blob/master/R/auditTrail.R'><code>R/auditTrail.R</code></a></small>
    <div class="hidden name"><code>audit_trail.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Facilitate the creation and modification of audit trails for NIfTI class
objects.</p>
    </div>

    <div class="ref-usage sourceCode"><pre class='sourceCode r'><code><span class='fu'>oro.nifti.info</span><span class='op'>(</span><span class='va'>type</span><span class='op'>)</span>

<span class='fu'>enableAuditTrail</span><span class='op'>(</span><span class='op'>)</span>

<span class='fu'>getLastCallWithName</span><span class='op'>(</span><span class='va'>functionName</span><span class='op'>)</span>

<span class='fu'>newAuditTrail</span><span class='op'>(</span><span class='op'>)</span>

<span class='fu'>niftiExtensionToAuditTrail</span><span class='op'>(</span>
  <span class='va'>nim</span>,
  workingDirectory <span class='op'>=</span> <span class='cn'>NULL</span>,
  filename <span class='op'>=</span> <span class='cn'>NULL</span>,
  call <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span>

<span class='fu'>niftiAuditTrailSystemNode</span><span class='op'>(</span>
  type <span class='op'>=</span> <span class='st'>"system-info"</span>,
  workingDirectory <span class='op'>=</span> <span class='cn'>NULL</span>,
  filename <span class='op'>=</span> <span class='cn'>NULL</span>,
  call <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span>

<span class='fu'>niftiAuditTrailSystemNodeEvent</span><span class='op'>(</span>
  <span class='va'>trail</span>,
  type <span class='op'>=</span> <span class='cn'>NULL</span>,
  call <span class='op'>=</span> <span class='cn'>NULL</span>,
  workingDirectory <span class='op'>=</span> <span class='cn'>NULL</span>,
  filename <span class='op'>=</span> <span class='cn'>NULL</span>,
  comment <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span>

<span class='fu'>niftiAuditTrailCreated</span><span class='op'>(</span>
  history <span class='op'>=</span> <span class='cn'>NULL</span>,
  call <span class='op'>=</span> <span class='cn'>NULL</span>,
  workingDirectory <span class='op'>=</span> <span class='cn'>NULL</span>,
  filename <span class='op'>=</span> <span class='cn'>NULL</span>
<span class='op'>)</span>

<span class='fu'>niftiAuditTrailEvent</span><span class='op'>(</span><span class='va'>trail</span>, type <span class='op'>=</span> <span class='cn'>NULL</span>, call <span class='op'>=</span> <span class='cn'>NULL</span>, comment <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span></code></pre></div>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>type</th>
      <td><p>An identifier to add some meaning to the event.</p></td>
    </tr>
    <tr>
      <th>functionName</th>
      <td><p>The name of a function on the call stack.</p></td>
    </tr>
    <tr>
      <th>nim</th>
      <td><p>is an object of class <code>niftiAuditTrail</code> or can be converted
to such.</p></td>
    </tr>
    <tr>
      <th>workingDirectory</th>
      <td><p>The working directory associated with the
&#8216;filename&#8217;.</p></td>
    </tr>
    <tr>
      <th>filename</th>
      <td><p>The filename associated with the nifti object.</p></td>
    </tr>
    <tr>
      <th>call</th>
      <td><p>A <code>call</code>, function name in the call-stack or a string.</p></td>
    </tr>
    <tr>
      <th>trail</th>
      <td><p>The <code>XMLAbstractNode</code> representing the audit trail or the
<code>niftiAuditTrail</code> object with a trail that will be amended.</p></td>
    </tr>
    <tr>
      <th>comment</th>
      <td><p>Some textual comment</p></td>
    </tr>
    <tr>
      <th>history</th>
      <td><p>An <code>XMLAbstractNode</code> to store historical events for
inclusion in the &#8216;trail&#8217;.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function <code>oro.nifti.info</code> is used to find the <code>ecode</code> or the
XML <code>namespace</code> relevant to the audit trail.</p>
<p>The function <code>enableAuditTrail</code> is turned &#8220;off&#8221; by default to
minimize package dependencies.  Should one wish to turn &#8220;on&#8221; the
audit trail functionality, then one should set the option
<code>NIfTI.audit.trail</code> to <code>TRUE</code> and call the function
<code>enableAuditTrail</code>.  Setting the option <code>NIfTI.audit.trail</code> to
<code>FALSE</code> will disable the audit trail.</p>
<p>The function <code>newAuditTrail</code> returns an <code>XMLAbstractNode</code>
representing the root node of an audit trail.  This is mostly intended as an
internal function.</p>
<p>The function <code>niftiExtensionToAuditTrail</code> takes an object representing
a NIfTI object, casts it as a <code>niftiAuditTrail</code> and checks if there is
an extension (a <code>niftiExtensionSection</code>) with <code>ecode</code> equal to
<code>oro.nifti.info("ecode")</code>; i.e. has a extension with data representing
a serialized audit trail.  The function will then strip the object of this
extension parsing the serialized <code>edata</code> into an audit trail and adding
a &#8216;read&#8217; event to the trail.</p>
<p>The function <code>niftiAuditTrailToExtension</code> takes a
<code>niftiAuditTrail</code> and returns a <code>niftiExtensionSection</code> with
<code>edata</code> containing the serialized form of the audit trail after adding
a &#8216;saved&#8217; event to the trail.</p>
<p>The function <code>niftiAuditTrailSystemNodeEvent</code> adds an element with name
equal to <code>type</code> to the <code>trail</code>.  It uses the
<code>niftiAuditTrailSystemNode</code> function to create the node.</p>
<p>The function <code>niftiAuditTrailSystemNode</code> is an internal function
creating an <code>XMLAbstractNode</code> element with name <code>type</code> and
attributes giving information about the R system and library.  The
<code>filename</code> and <code>call</code> will also be added as attributes if
available.</p>
<p>The function <code>niftiAuditTrailEvent</code> adds an element with name
<code>event</code> to the <code>trail</code>.  The arguments <code>type</code>,
<code>filename</code>, <code>call</code> are added as attributes and the <code>comment</code>
is the text value of the element.</p>
<p>The function <code>niftiAuditTrailCreated</code> will create a new audit trail
containing a system node element <code>created</code> with the child
<code>history</code> with the contents <code>history</code>.  If the last element of the
<code>history</code> given is an <code>event</code> with <code>type="processing"</code>, then
this node will be removed from the <code>history</code> and its <code>call</code>
attribute will be used as the value of the <code>call</code> attribute on the
<code>created</code> node.</p>
<p>The function <code>getLastCallWithName</code> will search the call stack for a
call of the function <code>functionName</code>, returning last call to that
function if possible.  It will default to the call of the function which
called the function which called getLastCallWithName if there was no such
call (and if there was no such call it will return the call of itself).</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>These functions are mostly intended to be used internally in order to
document the changes that occur to NIfTI objects due to functions that are
audit-trail aware.  However, as the precise manner in which these functions
are used is not documented anywhere else, we shall proceed to describe which
functions are audit-trail aware and how they interact with the audit trail.</p>
<p><code>as.nifti</code> and its S4 alias <code>as(nim, "nifti")</code> will always produce
<code>niftiAuditTrail</code> objects if the functionality is turned on.  The
function <code>niftiAuditTrailCreated</code> will be used and if an exemplar
object is provided (e.g., <code>as.nifti(array, niftiExemplar)</code>) then the
trail of the exemplar will be used as the <code>history</code>.</p>
<p><code>readNIfTI</code> and <code>writeNIfTI</code> also always produce
<code>niftiAuditTrail</code> objects if the functionality is turned on.  The
functions <code>niftiExtensionToAuditTrail</code> and
<code>niftiAuditTrailToExtension</code> are used internally by these functions to
facilitate this behaviour.</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Andrew Thornton <a href='mailto:zeripath@users.sourceforge.net'>zeripath@users.sourceforge.net</a> and Brandon
Whitcher <a href='mailto:bwhitcher@gmail.com'>bwhitcher@gmail.com</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <div class="ref-examples sourceCode"><pre class='sourceCode r'><code><span class='r-in'><span class='co'>## A good example of the use of these functions is shown by this</span></span>
<span class='r-in'><span class='co'>## wrapper function which takes a function fun(nim, ...) returning</span></span>
<span class='r-in'><span class='co'>## lists of arrays which are nifti-ized using as(...)</span></span>
<span class='r-in'><span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span><span class='st'>"niftiAuditTrail"</span><span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span></span>
<span class='r-in'><span class='fu'>enableAuditTrail</span><span class='op'>(</span><span class='op'>)</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='va'>wrapper</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>functionToWrap</span>, <span class='va'>nameOfCallingFunction</span>, <span class='va'>nim</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'>is</span><span class='op'>(</span><span class='va'>nim</span>, <span class='st'>"nifti"</span><span class='op'>)</span><span class='op'>)</span> </span>
<span class='r-in'>    <span class='va'>nim</span> <span class='op'>&lt;-</span> <span class='fu'>as</span><span class='op'>(</span><span class='va'>nim</span>, <span class='st'>"nifti"</span><span class='op'>)</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'>is</span><span class='op'>(</span><span class='va'>nim</span>, <span class='st'>"niftiAuditTrail"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>    <span class='co'>## This will force as(...) to set the call which created the</span></span>
<span class='r-in'>    <span class='co'>## results to the calling function's call rather than</span></span>
<span class='r-in'>    <span class='co'>## as(result, nifti) as it would otherwise do</span></span>
<span class='r-in'>    <span class='fu'>slot</span><span class='op'>(</span><span class='va'>nim</span>, <span class='st'>"trail"</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='fu'>niftiAuditTrailEvent</span><span class='op'>(</span><span class='fu'>slot</span><span class='op'>(</span><span class='va'>nim</span>, <span class='st'>"trail"</span><span class='op'>)</span>, <span class='st'>"processing"</span>,</span>
<span class='r-in'>                                      <span class='va'>nameOfCallingFunction</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'>  </span>
<span class='r-in'>  <span class='va'>result</span> <span class='op'>&lt;-</span> <span class='fu'>functionToWrap</span><span class='op'>(</span><span class='va'>nim</span>, <span class='va'>...</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='fu'>as</span><span class='op'>(</span><span class='va'>result</span>, <span class='st'>"nifti"</span><span class='op'>)</span> <span class='op'>&lt;-</span> <span class='va'>nim</span></span>
<span class='r-in'>  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>result</span><span class='op'>)</span></span>
<span class='r-in'><span class='op'>}</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## An example of how wrapper is used follows:</span></span>
<span class='r-in'><span class='va'>functionToWrap</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>ignored</span>, <span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/array.html'>array</a></span><span class='op'>(</span><span class='fl'>1</span>, dim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'><span class='op'>}</span></span>
<span class='r-in'></span>
<span class='r-in'><span class='co'>## The nifti-ized form</span></span>
<span class='r-in'><span class='va'>niftiizedForm</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>nim</span>,<span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='fu'>wrapper</span><span class='op'>(</span><span class='va'>functionToWrap</span>, <span class='st'>"niftiizedForm"</span>, <span class='va'>nim</span>, <span class='va'>...</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'><span class='op'>}</span></span>
<span class='r-in'> </span>
<span class='r-in'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>  <span class='kw'>if</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Logic.html'>isTRUE</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span><span class='op'>(</span><span class='st'>"niftiAuditTrail"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'>slot</span><span class='op'>(</span><span class='fu'><a href='as.nifti.html'>as.nifti</a></span><span class='op'>(</span><span class='fu'>functionToWrap</span><span class='op'>(</span><span class='fu'><a href='nifti.html'>nifti</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fl'>4</span>, <span class='fl'>4</span><span class='op'>)</span>, <span class='fu'><a href='nifti.html'>nifti</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>, <span class='st'>"trail"</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>    <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='fu'>slot</span><span class='op'>(</span><span class='fu'>niftiizedForm</span><span class='op'>(</span><span class='fu'><a href='nifti.html'>nifti</a></span><span class='op'>(</span><span class='op'>)</span>, <span class='fl'>4</span>, <span class='fl'>4</span><span class='op'>)</span>, <span class='st'>"trail"</span><span class='op'>)</span><span class='op'>)</span></span>
<span class='r-in'>  <span class='op'>}</span></span>
<span class='r-in'><span class='op'>}</span></span>
</code></pre></div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p><p>Developed by Brandon Whitcher, Volker Schmid, Andrew Thornton, John Muschelli.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


